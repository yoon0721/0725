<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>
  </head>
  <body>
    <h1>Todo</h1>

    <div>
      <input type="text" id="todoContent" placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
      <button onclick="insertTodo();">Îì±Î°ù</button>
    </div>

    <table border="1">
      <thead>
        <tr>
          <th>ÎÇ¥Ïö©</th>
          <th>ÎÇ†Ïßú</th>
          <th>ÎÑòÎ≤Ñ</th>
          <th>‚úÖ</th>
          <th>Î≤ÑÌäº</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      // todo List
      function loadTodos() {
        const url = 'http://127.0.0.1:8080/api/todo';
        fetch(url)
          .then((resp) => {
            if (!resp.ok) throw new Error('ÏÑúÎ≤Ñ Ïò§Î•ò');
            return resp.json();
          })
          .then((data) => {
            const tbody = document.querySelector('tbody');
            tbody.innerHTML = '';

            data.forEach((todo) => {
              const tr = document.createElement('tr');

              let completeIcon = '';
              if (todo.complete === 'Y') {
                completeIcon = '‚úÖ';
              } else completeIcon = 'üî•';

              tr.innerHTML = `
              <td>${todo.content}</td>
              <td>${todo.createAt}</td>
              <td>${todo.id}</td>
              <td>${completeIcon}</td>
              <td><button onclick="deleteTodo(${todo.id})">ÏÑ±Í≥µ</button></td
            `;
              tbody.appendChild(tr);
            });
          })
          .catch((err) => {
            console.error('Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', err);
          });
      }
      loadTodos();

      // Îì±Î°ù
      function insertTodo() {
        const content = document.querySelector('#todoContent').value;
        const url = 'http://127.0.0.1:8080/api/todo/insert';

        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content }),
        })
          .then((resp) => {
            if (!resp.ok) throw new Error('Îì±Î°ù Ïã§Ìå®');
            return resp.json();
          })
          .then((result) => {
            if (result === 1) {
              content.value = '';
              loadTodos();
            } else {
              alert('Îì±Î°ù Ïã§Ìå®');
            }
          })
          .catch((err) => {
            console.error('Îì±Î°ù ÏóêÎü¨:', err);
          });
      }

      // ÏÇ≠Ï†ú
      function deleteTodo(id) {
        const url = `http://127.0.0.1:8080/api/todo/${id}`;
        const option = {
          method: 'DELETE',
        };

        fetch(url, option)
          .then((resp) => resp.json())
          .then((result) => {
            if (result == 1) {
              loadTodos();
            } else {
              alert('ÏÇ≠Ï†ú Ïã§Ìå®');
            }
          })

          .catch((err) => {
            console.error('ÏÇ≠Ï†ú Ïò§Î•ò:', err);
          });
      }
    </script>
  </body>
</html>
